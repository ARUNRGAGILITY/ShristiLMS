<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VidyaLMS - Learning</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
    <style>
        /* Mobile-first responsive styles */
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        @media (min-width: 640px) {
            .container {
                max-width: 640px;
                padding: 0 1.5rem;
            }
        }
        
        @media (min-width: 768px) {
            .container {
                max-width: 768px;
            }
        }
        
        @media (min-width: 1024px) {
            .container {
                max-width: 1024px;
                padding: 0 2rem;
            }
        }
        
        @media (min-width: 1280px) {
            .container {
                max-width: 1280px;
            }
        }
        
        /* Mobile-first layout */
        .mobile-layout {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        @media (min-width: 1024px) {
            .mobile-layout {
                flex-direction: row;
            }
        }
        
        /* Mobile-first sidebar */
        .mobile-sidebar {
            width: 100%;
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
            overflow: hidden;
        }
        
        @media (min-width: 1024px) {
            .mobile-sidebar {
                width: 25%;
                margin-bottom: 0;
                margin-right: 1.5rem;
                position: sticky;
                top: 5rem;
                height: fit-content;
            }
        }
        
        /* Mobile-first content area */
        .mobile-content {
            flex: 1;
            min-width: 0;
        }
        
        /* Mobile-first cards */
        .mobile-card {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .mobile-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        /* Mobile-first buttons */
        .mobile-btn {
            width: 100%;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }
        
        @media (min-width: 640px) {
            .mobile-btn {
                width: auto;
                padding: 0.75rem 1.5rem;
                font-size: 1rem;
            }
        }
        
        /* Mobile-first text scaling */
        .mobile-text-xs { font-size: 0.75rem; line-height: 1rem; }
        .mobile-text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .mobile-text-base { font-size: 1rem; line-height: 1.5rem; }
        .mobile-text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .mobile-text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .mobile-text-2xl { font-size: 1.5rem; line-height: 2rem; }
        
        @media (min-width: 640px) {
            .mobile-text-xs { font-size: 0.875rem; line-height: 1.25rem; }
            .mobile-text-sm { font-size: 1rem; line-height: 1.5rem; }
            .mobile-text-base { font-size: 1.125rem; line-height: 1.75rem; }
            .mobile-text-lg { font-size: 1.25rem; line-height: 1.75rem; }
            .mobile-text-xl { font-size: 1.5rem; line-height: 2rem; }
            .mobile-text-2xl { font-size: 1.875rem; line-height: 2.25rem; }
        }
        
        @media (min-width: 1024px) {
            .mobile-text-xs { font-size: 1rem; line-height: 1.5rem; }
            .mobile-text-sm { font-size: 1.125rem; line-height: 1.75rem; }
            .mobile-text-base { font-size: 1.25rem; line-height: 1.75rem; }
            .mobile-text-lg { font-size: 1.5rem; line-height: 2rem; }
            .mobile-text-xl { font-size: 1.875rem; line-height: 2.25rem; }
            .mobile-text-2xl { font-size: 2.25rem; line-height: 2.5rem; }
        }
        
        /* Mobile-first spacing */
        .mobile-spacing-xs { padding: 0.5rem; }
        .mobile-spacing-sm { padding: 1rem; }
        .mobile-spacing-md { padding: 1.5rem; }
        .mobile-spacing-lg { padding: 2rem; }
        
        @media (min-width: 640px) {
            .mobile-spacing-xs { padding: 0.75rem; }
            .mobile-spacing-sm { padding: 1.25rem; }
            .mobile-spacing-md { padding: 1.75rem; }
            .mobile-spacing-lg { padding: 2.5rem; }
        }
        
        @media (min-width: 1024px) {
            .mobile-spacing-xs { padding: 1rem; }
            .mobile-spacing-sm { padding: 1.5rem; }
            .mobile-spacing-md { padding: 2rem; }
            .mobile-spacing-lg { padding: 3rem; }
        }
        
        /* Chapter item styles */
        .chapter-item {
            transition: all 0.3s ease;
            padding: 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            margin-bottom: 0.5rem;
        }
        
        .chapter-item:hover {
            transform: translateX(4px);
        }
        
        .chapter-item.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
        
        /* Content section styles */
        .content-section {
            animation: fadeIn 0.5s ease-out;
            margin-bottom: 2rem;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Progress circle */
        .progress-circle {
            transition: stroke-dasharray 0.5s ease-in-out;
        }
        
        /* Copy button */
        .copy-btn {
            transition: all 0.3s ease;
        }
        
        /* Responsive content styles */
        .content-section .prose {
            max-width: none;
        }
        
        .content-section .prose h3 {
            font-size: 1.25rem;
            line-height: 1.75rem;
        }
        
        .content-section .prose h4 {
            font-size: 1.125rem;
            line-height: 1.5rem;
        }
        
        .content-section .prose p {
            font-size: 0.875rem;
            line-height: 1.25rem;
        }
        
        /* Mobile responsive adjustments */
        @media (max-width: 640px) {
            .content-section .prose h3 {
                font-size: 1.125rem;
                line-height: 1.5rem;
            }
            
            .content-section .prose h4 {
                font-size: 1rem;
                line-height: 1.375rem;
            }
            
            .content-section .prose p {
                font-size: 0.75rem;
                line-height: 1.125rem;
            }
            
            .content-section .grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Tablet responsive adjustments */
        @media (min-width: 641px) and (max-width: 1023px) {
            .content-section .grid.grid-cols-3 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .content-section .grid.grid-cols-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Ensure code blocks are responsive */
        .content-section pre {
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .content-section code {
            font-size: 0.75rem;
            line-height: 1.125rem;
        }
        
        @media (min-width: 640px) {
            .content-section code {
                font-size: 0.875rem;
                line-height: 1.25rem;
            }
        }
        
        /* Prevent content overflow */
        .content-section {
            max-width: 100%;
            overflow-wrap: break-word;
            word-wrap: break-word;
        }
        
        .content-section img {
            max-width: 100%;
            height: auto;
        }
        
        .content-section table {
            max-width: 100%;
            overflow-x: auto;
            display: block;
        }
        
        /* Ensure grid items don't overflow */
        .content-section .grid {
            max-width: 100%;
        }
        
        .content-section .grid > * {
            min-width: 0;
            overflow-wrap: break-word;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Standard Navigation -->
    <nav class="bg-blue-600 text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 bg-white rounded-full flex items-center justify-center">
                        <span class="text-blue-600 font-bold text-lg sm:text-xl">V</span>
                    </div>
                    <h1 class="text-lg sm:text-xl lg:text-2xl font-bold">VidyaLMS</h1>
                </div>
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <a href="index.html" class="mobile-btn bg-blue-700 hover:bg-blue-800 transition text-xs sm:text-sm">
                        🏠 <span class="hidden sm:inline">Home</span>
                    </a>
                    <button id="quizBtn" class="mobile-btn bg-green-600 hover:bg-green-700 transition text-xs sm:text-sm">
                        📝 <span class="hidden sm:inline">Take Quiz</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile-First Course Header -->
    <div class="bg-white shadow-sm border-b">
        <div class="container mx-auto px-4 py-4">
            <div class="flex flex-col sm:flex-row lg:flex-row items-start sm:items-center justify-between gap-4">
                <div class="flex-1 min-w-0">
                    <h1 id="courseTitle" class="mobile-text-lg sm:mobile-text-xl lg:mobile-text-2xl font-bold text-gray-800 mb-1 break-words">Loading...</h1>
                    <p id="courseInstructor" class="mobile-text-sm sm:mobile-text-base text-gray-600 break-words">Loading instructor...</p>
                </div>
                <div class="flex flex-col sm:flex-row items-center gap-4 lg:gap-6">
                    <!-- Progress Circle -->
                    <div class="relative w-12 h-12 sm:w-16 sm:h-16">
                        <svg class="w-12 h-12 sm:w-16 sm:h-16 transform -rotate-90" viewBox="0 0 64 64">
                            <circle cx="32" cy="32" r="28" fill="none" stroke="#e5e7eb" stroke-width="4"/>
                            <circle id="progressCircle" cx="32" cy="32" r="28" fill="none" stroke="#3b82f6" 
                                    stroke-width="4" stroke-dasharray="0 176" class="progress-circle"/>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span id="progressPercent" class="mobile-text-xs sm:mobile-text-sm font-bold text-blue-600">0%</span>
                        </div>
                    </div>
                    <!-- Content Filters -->
                    <div class="flex flex-wrap items-center gap-2 sm:gap-3 lg:gap-4 bg-gray-100 px-3 sm:px-4 py-2 rounded-lg">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="showTheory" checked class="rounded text-blue-600 w-4 h-4 sm:w-5 sm:h-5 accent-blue-600">
                            <span class="mobile-text-xs sm:mobile-text-sm font-medium whitespace-nowrap">📖 Theory</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="showCode" checked class="rounded text-blue-600 w-4 h-4 sm:w-5 sm:h-5 accent-blue-600">
                            <span class="mobile-text-xs sm:mobile-text-sm font-medium whitespace-nowrap">💻 Code</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="showTips" checked class="rounded text-blue-600 w-4 h-4 sm:w-5 sm:h-5 accent-blue-600">
                            <span class="mobile-text-xs sm:mobile-text-sm font-medium whitespace-nowrap">💡 Tips</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile-First Main Content -->
    <div class="container mx-auto px-4 py-6">
        <div class="mobile-layout">
            <!-- Mobile-First Sidebar -->
            <div class="mobile-sidebar">
                <div class="mobile-spacing-sm">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="mobile-text-lg font-bold text-gray-800">📚 Chapters</h3>
                        <span id="chapterCount" class="mobile-text-sm text-gray-500">0 chapters</span>
                    </div>
                    <div id="chaptersList" class="space-y-2 max-h-96 lg:max-h-none overflow-y-auto">
                        <!-- Chapters will be populated here -->
                    </div>
                    
                    <!-- Course Info -->
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <h4 class="font-medium text-gray-800 mb-3 mobile-text-sm">📊 Course Details</h4>
                        <div class="space-y-2 mobile-text-xs text-gray-600">
                            <div class="flex justify-between">
                                <span>Duration:</span>
                                <span id="courseDuration" class="font-medium">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Difficulty:</span>
                                <span id="courseDifficulty" class="font-medium">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Modules:</span>
                                <span id="courseModules" class="font-medium">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile-First Content Area -->
            <div class="mobile-content">
                <!-- Chapter Content -->
                <div class="mobile-card">
                    <div id="chapterHeader" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white mobile-spacing-sm">
                        <h2 id="chapterTitle" class="mobile-text-lg sm:mobile-text-xl lg:mobile-text-2xl font-bold mb-2 break-words">Select a chapter to begin</h2>
                        <p id="chapterDescription" class="text-blue-100 mobile-text-sm sm:mobile-text-base break-words">Choose a chapter from the sidebar to start learning</p>
                    </div>

                    <div id="chapterContent" class="mobile-spacing-sm lg:mobile-spacing-md overflow-x-auto">
                        <div class="text-center py-8 sm:py-12">
                            <div class="text-4xl sm:text-6xl mb-4">📚</div>
                            <h3 class="mobile-text-lg sm:mobile-text-xl font-medium text-gray-600 mb-2">Ready to Learn?</h3>
                            <p class="text-gray-500 mobile-text-sm sm:mobile-text-base">Select a chapter from the left sidebar to begin your learning journey</p>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="flex flex-col sm:flex-row justify-between mt-6 gap-4">
                    <button id="prevChapterBtn" class="mobile-btn bg-gray-300 text-gray-700 hover:bg-gray-400 transition disabled:opacity-50 mobile-text-sm sm:mobile-text-base" disabled>
                        ← Previous Chapter
                    </button>
                    <button id="nextChapterBtn" class="mobile-btn bg-blue-600 text-white hover:bg-blue-700 transition disabled:opacity-50 mobile-text-sm sm:mobile-text-base" disabled>
                        Next Chapter →
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/courses.js"></script>
    <script src="js/shared-nav.js"></script>
    <script>
        let currentCourse = null;
        let courseContent = null;
        let currentChapterIndex = 0;
        let completedChapters = new Set();
        let isContentLoaded = false;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const courseId = urlParams.get('course');
            
            if (courseId) {
                loadCourse(courseId);
            } else {
                alert('No course specified');
                window.location.href = 'index.html';
            }

            setupEventListeners();
            mermaid.initialize({ startOnLoad: true });
        });

        function setupEventListeners() {
            // Content filters
            document.getElementById('showTheory').addEventListener('change', updateContentDisplay);
            document.getElementById('showCode').addEventListener('change', updateContentDisplay);
            document.getElementById('showTips').addEventListener('change', updateContentDisplay);

            // Navigation buttons
            document.getElementById('prevChapterBtn').addEventListener('click', () => navigateChapter(-1));
            document.getElementById('nextChapterBtn').addEventListener('click', () => navigateChapter(1));

            // Quiz button
            document.getElementById('quizBtn').addEventListener('click', () => {
                window.location.href = `quiz.html?course=${currentCourse.id}`;
            });
        }

        async function loadCourse(courseId) {
            // Load course data
            currentCourse = getCourseById(courseId);
            if (!currentCourse) {
                alert('Course not found');
                window.location.href = 'index.html';
                return;
            }

            // Update course header
            updateCourseHeader();

            // Load course content with timeout protection
            let contentLoaded = false;
            
            try {
                // Create script element for the course content
                const script = document.createElement('script');
                script.src = `courses/${courseId}/${courseId}_content.js`;
                
                // Set a timeout to prevent infinite loading
                const loadTimeout = setTimeout(() => {
                    if (!contentLoaded) {
                        console.log('Course content loading timeout, using demo content');
                        loadDemoContent(courseId);
                        contentLoaded = true;
                    }
                }, 3000); // 3 second timeout
                
                script.onload = function() {
                    if (!contentLoaded) {
                        clearTimeout(loadTimeout);
                        contentLoaded = true;
                        
                        // Content should now be available in window.courseContent
                        if (window.courseContent) {
                            courseContent = window.courseContent;
                            initializeCourse();
                        } else {
                            console.log('Course content not found in loaded script, using demo content');
                            loadDemoContent(courseId);
                        }
                    }
                };
                
                script.onerror = function() {
                    if (!contentLoaded) {
                        clearTimeout(loadTimeout);
                        contentLoaded = true;
                        console.log('Failed to load course content, using demo content');
                        loadDemoContent(courseId);
                    }
                };
                
                document.head.appendChild(script);
                
            } catch (error) {
                if (!contentLoaded) {
                    contentLoaded = true;
                    console.log('Error loading course content, using demo content');
                    loadDemoContent(courseId);
                }
            }
        }

        function updateCourseHeader() {
            document.getElementById('courseTitle').textContent = currentCourse.name;
            document.getElementById('courseInstructor').textContent = `Instructor: ${currentCourse.instructor}`;
            document.getElementById('courseDuration').textContent = currentCourse.duration;
            document.getElementById('courseDifficulty').textContent = currentCourse.difficulty;
            document.getElementById('courseModules').textContent = currentCourse.modules;
            document.title = `VidyaLMS - ${currentCourse.name}`;
        }

        function loadDemoContent(courseId) {
            // Demo content for AI Foundations
            if (courseId === 'ai-foundations') {
                courseContent = {
                    chapters: [
                        {
                            id: 1,
                            title: 'Introduction to Artificial Intelligence',
                            description: 'Understanding the fundamentals of AI and its applications',
                            theory: `
                                <div class="prose max-w-none">
                                    <h3 class="mobile-text-lg sm:mobile-text-xl font-bold mb-4">What is Artificial Intelligence?</h3>
                                    <p class="mobile-text-sm sm:mobile-text-base mb-4">Artificial Intelligence (AI) is the simulation of human intelligence in machines that are programmed to think and learn like humans. AI systems can perform tasks that typically require human intelligence, such as visual perception, speech recognition, decision-making, and language translation.</p>
                                    
                                    <h4 class="mobile-text-base sm:mobile-text-lg font-semibold mb-3 mt-6">Brief History of AI</h4>
                                    <ul class="list-disc pl-6 mb-4 mobile-text-sm sm:mobile-text-base">
                                        <li><strong>1950s:</strong> Alan Turing proposes the Turing Test</li>
                                        <li><strong>1956:</strong> Term "Artificial Intelligence" coined at Dartmouth Conference</li>
                                        <li><strong>1980s:</strong> Expert systems gain popularity</li>
                                        <li><strong>1990s:</strong> Machine learning algorithms advance</li>
                                        <li><strong>2010s:</strong> Deep learning revolution begins</li>
                                        <li><strong>2020s:</strong> Large language models and generative AI emerge</li>
                                    </ul>

                                    <h4 class="mobile-text-base sm:mobile-text-lg font-semibold mb-3 mt-6">Types of AI</h4>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                                        <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500">
                                            <h5 class="font-bold text-blue-800 mobile-text-sm">Narrow AI (ANI)</h5>
                                            <p class="text-blue-700 mobile-text-xs sm:mobile-text-sm">AI designed for specific tasks. This is what we have today.</p>
                                            <p class="text-xs text-blue-600 mt-2">Examples: Siri, Chess programs, Image recognition</p>
                                        </div>
                                        <div class="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-500">
                                            <h5 class="font-bold text-yellow-800 mobile-text-sm">General AI (AGI)</h5>
                                            <p class="text-yellow-700 mobile-text-xs sm:mobile-text-sm">AI with human-level cognitive abilities across all domains.</p>
                                            <p class="text-xs text-yellow-600 mt-2">Status: Theoretical, not yet achieved</p>
                                        </div>
                                        <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-500">
                                            <h5 class="font-bold text-red-800 mobile-text-sm">Super AI (ASI)</h5>
                                            <p class="text-red-700 mobile-text-xs sm:mobile-text-sm">AI that surpasses human intelligence in all aspects.</p>
                                            <p class="text-xs text-red-600 mt-2">Status: Hypothetical future possibility</p>
                                        </div>
                                    </div>
                                </div>
                            `
                        }
                    ]
                };
            }
            
            initializeCourse();
        }

        function initializeCourse() {
            if (!isContentLoaded && courseContent && courseContent.chapters.length > 0) {
                isContentLoaded = true;
                renderChapters();
                displayChapter(0); // Display first chapter
            }
        }

        function renderChapters() {
            const chaptersList = document.getElementById('chaptersList');
            chaptersList.innerHTML = '';

            document.getElementById('chapterCount').textContent = `${courseContent.chapters.length} chapters`;

            courseContent.chapters.forEach((chapter, index) => {
                const chapterItem = document.createElement('div');
                chapterItem.className = `chapter-item ${index === currentChapterIndex ? 'active' : 'bg-gray-50 hover:bg-gray-100 text-gray-700'}`;
                
                const isCompleted = completedChapters.has(index);
                chapterItem.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex-1 min-w-0">
                            <div class="font-medium mobile-text-sm break-words">${chapter.id}. ${chapter.title}</div>
                            <div class="mobile-text-xs opacity-75 mt-1 break-words">${chapter.description}</div>
                        </div>
                        <div class="text-right ml-2">
                            ${isCompleted ? '<span class="text-green-500">✓</span>' : '<span class="text-gray-400">○</span>'}
                        </div>
                    </div>
                `;
                
                chapterItem.onclick = () => displayChapter(index);
                chaptersList.appendChild(chapterItem);
            });
        }

        function displayChapter(chapterIndex) {
            if (chapterIndex < 0 || chapterIndex >= courseContent.chapters.length) return;
            
            currentChapterIndex = chapterIndex;
            const chapter = courseContent.chapters[chapterIndex];
            
            // Update chapter header
            document.getElementById('chapterTitle').textContent = chapter.title;
            document.getElementById('chapterDescription').textContent = chapter.description;
            
            // Mark chapter as completed when viewed
            completedChapters.add(chapterIndex);
            
            // Update content
            updateContentDisplay();
            
            // Update navigation buttons
            updateNavigationButtons();
            
            // Update progress
            updateProgress();
            
            // Update chapter styling without re-rendering
            updateChapterStyling();

             // Scroll to top of the page smoothly
            window.scrollTo({ 
                top: 0, 
                behavior: 'smooth' 
            });
        }

        function updateChapterStyling() {
            const chapterItems = document.querySelectorAll('.chapter-item');
            chapterItems.forEach((item, index) => {
                if (index === currentChapterIndex) {
                    item.className = 'chapter-item active';
                } else {
                    item.className = 'chapter-item bg-gray-50 hover:bg-gray-100 text-gray-700';
                }
                
                // Update completion status
                const isCompleted = completedChapters.has(index);
                const statusSpan = item.querySelector('.text-right span');
                if (statusSpan) {
                    statusSpan.className = isCompleted ? 'text-green-500' : 'text-gray-400';
                    statusSpan.textContent = isCompleted ? '✓' : '○';
                }
            });
        }

        function updateContentDisplay() {
            if (!courseContent || !courseContent.chapters[currentChapterIndex]) return;
            
            const chapter = courseContent.chapters[currentChapterIndex];
            const showTheory = document.getElementById('showTheory').checked;
            const showCode = document.getElementById('showCode').checked;
            const showTips = document.getElementById('showTips').checked;

            let html = '';
            
            if (showTheory && chapter.theory) {
                html += `<div class="content-section theory-content mb-8">${chapter.theory}</div>`;
            }
            
            if (showCode && chapter.code) {
                html += `<div class="content-section code-content mb-8">${chapter.code}</div>`;
            }
            
            if (showTips && chapter.tips) {
                html += `<div class="content-section tips-content">${chapter.tips}</div>`;
            }

            document.getElementById('chapterContent').innerHTML = html || '<div class="text-center py-12 text-gray-500 mobile-text-sm sm:mobile-text-base">Select content types to view</div>';
            
            // Fix: Use setTimeout to avoid call stack issues and only highlight if Prism exists
            if (typeof Prism !== 'undefined' && Prism.highlightElement) {
                setTimeout(() => {
                    try {
                        // Only highlight code blocks in the chapter content area
                        const contentArea = document.getElementById('chapterContent');
                        const codeBlocks = contentArea.querySelectorAll('pre code');
                        codeBlocks.forEach(block => {
                            Prism.highlightElement(block);
                        });
                    } catch (error) {
                        console.warn('Prism highlighting error:', error);
                    }
                }, 100);
            }
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevChapterBtn');
            const nextBtn = document.getElementById('nextChapterBtn');
            
            prevBtn.disabled = currentChapterIndex === 0;
            nextBtn.disabled = currentChapterIndex === courseContent.chapters.length - 1;
        }

        function navigateChapter(direction) {
            const newIndex = currentChapterIndex + direction;
            if (newIndex >= 0 && newIndex < courseContent.chapters.length) {
                displayChapter(newIndex);
            }
        }

        function updateProgress() {
            const progress = (completedChapters.size / courseContent.chapters.length) * 100;
            const progressCircle = document.getElementById('progressCircle');
            const progressPercent = document.getElementById('progressPercent');
            
            // Update progress circle
            const circumference = 2 * Math.PI * 28; // r = 28
            const dashArray = (progress / 100) * circumference;
            progressCircle.style.strokeDasharray = `${dashArray} ${circumference}`;
            
            // Update percentage text
            progressPercent.textContent = `${Math.round(progress)}%`;
        }

        function copyCode(button) {
            const codeBlock = button.closest('.bg-gray-900').querySelector('code');
            const textArea = document.createElement('textarea');
            textArea.value = codeBlock.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            // Visual feedback
            const originalText = button.textContent;
            button.textContent = '✅ Copied!';
            button.classList.add('bg-green-600');
            setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('bg-green-600');
            }, 2000);
        }
    </script>
</body>
</html>