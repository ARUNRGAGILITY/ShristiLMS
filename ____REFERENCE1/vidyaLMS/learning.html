<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VidyaLMS - Learning</title>
    <link rel="icon" type="image/png" href="assets/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
    
    <!-- Global CSS for custom styles -->
    <link rel="stylesheet" href="global.css">
</head>
<body class="min-h-screen bg-slate-900 text-white">
    <!-- Standard Navigation -->
    <nav class="text-white shadow-lg sticky top-0 z-50 bg-slate-900/80 backdrop-blur-md">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <div class="w-12 h-12 sm:w-16 sm:h-16 flex items-center justify-center">
                        <img src="assets/logo.png" alt="VidyaLMS Logo" class="w-full h-full object-contain">
                    </div>
                </div>
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <a href="index.html" class="mobile-btn ripple-btn transition text-xs sm:text-sm hover:scale-105 hover:shadow-lg" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <i class="fas fa-home"></i> <span class="hidden sm:inline">Home</span>
                    </a>
                                            <button id="quizBtn" class="mobile-btn ripple-btn transition text-xs sm:text-sm hover:scale-105 hover:shadow-lg" style="background: linear-gradient(135deg, #00BFA6 0%, #00C9A7 100%);">
                        <i class="fas fa-clipboard-list"></i> <span class="hidden sm:inline">Take Quiz</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile-First Course Header -->
    <div class="bg-slate-800 shadow-lg border-b border-slate-700">
        <div class="container mx-auto px-4 py-4">
            <div class="flex flex-col sm:flex-row lg:flex-row items-start sm:items-center justify-between gap-4">
                <div class="flex-1 min-w-0">
                    <h1 id="courseTitle" class="mobile-text-lg sm:mobile-text-xl lg:mobile-text-2xl font-bold text-white mb-1 break-words">Loading...</h1>
                    <p id="courseInstructor" class="mobile-text-sm sm:mobile-text-base text-slate-300 break-words">Loading instructor...</p>
                </div>
                <div class="flex flex-col sm:flex-row items-center gap-4 lg:gap-6">
                    <!-- Progress Circle -->
                    <div class="relative w-12 h-12 sm:w-16 sm:h-16">
                        <svg class="w-12 h-12 sm:w-16 sm:h-16 transform -rotate-90" viewBox="0 0 64 64">
                            <circle cx="32" cy="32" r="28" fill="none" stroke="#475569" stroke-width="4"/>
                            <circle id="progressCircle" cx="32" cy="32" r="28" fill="none" stroke="#3b82f6" 
                                    stroke-width="4" stroke-dasharray="0 176" class="progress-circle"/>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span id="progressPercent" class="mobile-text-xs sm:mobile-text-sm font-bold text-blue-400">0%</span>
                        </div>
                    </div>
                    <!-- Content Filters -->
                    <div class="flex flex-wrap items-center gap-2 sm:gap-3 lg:gap-4 bg-slate-700 px-3 sm:px-4 py-2 rounded-lg border border-slate-600">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="showTheory" checked class="content-filter rounded text-blue-400 w-4 h-4 sm:w-5 sm:h-5 accent-blue-400">
                            <span class="mobile-text-xs sm:mobile-text-sm font-medium whitespace-nowrap text-slate-200">Theory</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="showCode" checked class="content-filter rounded text-blue-400 w-4 h-4 sm:w-5 sm:h-5 accent-blue-400">
                            <span class="mobile-text-xs sm:mobile-text-sm font-medium whitespace-nowrap text-slate-200">Code</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="showTips" checked class="content-filter rounded text-blue-400 w-4 h-4 sm:w-5 sm:h-5 accent-blue-400">
                            <span class="mobile-text-xs sm:mobile-text-sm font-medium whitespace-nowrap text-slate-200">Tips</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile-First Main Content -->
    <div class="container mx-auto px-4 py-6">
        <div class="mobile-layout">
            <!-- Mobile-First Sidebar -->
            <div class="mobile-sidebar">
                <div class="mobile-spacing-sm">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="mobile-text-lg font-bold text-white"><i class="fas fa-book mr-2"></i>Lessons</h3>
                        <span id="chapterCount" class="mobile-text-sm text-slate-400">0</span>
                    </div>
                    <div id="chaptersList" class="space-y-2 max-h-96 lg:max-h-none overflow-y-auto">
                        <!-- Chapters will be populated here -->
                    </div>
                    
                    <!-- Course Info -->
                    <div class="mt-8 pt-6 border-t border-slate-600">
                        <h4 class="font-medium text-white mb-3 mobile-text-sm"><i class="fas fa-info mr-2"></i>Info</h4>
                        <div class="space-y-2 mobile-text-xs text-slate-300">
                            <div class="flex justify-between">
                                <span>Time:</span>
                                <span id="courseDuration" class="font-medium text-slate-200">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Level:</span>
                                <span id="courseDifficulty" class="font-medium text-slate-200">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Units:</span>
                                <span id="courseModules" class="font-medium text-slate-200">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile-First Content Area -->
            <div class="mobile-content">
                <!-- Top Navigation Buttons -->
                <div class="flex justify-between items-center mb-6">
                    <button id="prevChapterBtnTop" 
                            class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition disabled:opacity-50 disabled:cursor-not-allowed" 
                            disabled>
                        ← Previous
                    </button>
                    
                    <button id="nextChapterBtnTop" 
                            class="px-6 py-3 ripple-btn text-white rounded-lg transition hover:scale-105 hover:shadow-lg" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" disabled>
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>

                <!-- Chapter Content -->
                <div class="mobile-card">
                    <div id="chapterHeader" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white mobile-spacing-sm">
                        <h2 id="chapterTitle" class="mobile-text-lg sm:mobile-text-xl lg:mobile-text-2xl font-bold mb-2 break-words">Select a chapter to begin</h2>
                        <p id="chapterDescription" class="text-blue-100 mobile-text-sm sm:mobile-text-base break-words">Choose a chapter from the sidebar to start learning</p>
                    </div>

                    <div id="chapterContent" class="mobile-spacing-sm lg:mobile-spacing-md overflow-x-auto">
                        <div class="text-center py-8 sm:py-12">
                            <div class="text-4xl sm:text-6xl mb-4">
                                <i class="fas fa-book"></i>
                            </div>
                            <h3 class="mobile-text-lg sm:mobile-text-xl font-medium text-slate-300 mb-2">Ready to Learn?</h3>
                            <p class="text-slate-400 mobile-text-sm sm:mobile-text-base">Select a chapter from the left sidebar to begin your learning journey</p>
                        </div>
                    </div>
                </div>

                <!-- Bottom Navigation Buttons -->
                <div class="flex justify-between items-center mt-6">
                    <button id="prevChapterBtn" 
                            class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition disabled:opacity-50 disabled:cursor-not-allowed" 
                            disabled>
                        ← Previous
                    </button>
                    
                    <button id="nextChapterBtn" 
                            class="px-6 py-3 ripple-btn text-white rounded-lg transition hover:scale-105 hover:shadow-lg" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" disabled>
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/courses.js"></script>
    <script src="js/shared-nav.js"></script>
    <script>
        /**
         * Creates a modern multi-layered ripple effect on button click
         * @param {Event} event - The click event
         */
        function rippleEffect(event) {
            const btn = event.currentTarget;

            // Create main ripple
            const circle = document.createElement("span");
            const diameter = Math.max(btn.clientWidth, btn.clientHeight);
            const radius = diameter / 2;

            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${event.clientX - (btn.offsetLeft + radius)}px`;
            circle.style.top = `${event.clientY - (btn.offsetTop + radius)}px`;
            circle.classList.add("ripple");

            // Remove existing ripples
            const existingRipples = btn.getElementsByClassName("ripple");
            Array.from(existingRipples).forEach(ripple => ripple.remove());

            // Add new ripple
            btn.appendChild(circle);

            // Create additional ripple layers for more complex effect
            setTimeout(() => {
                const secondaryCircle = document.createElement("span");
                secondaryCircle.style.width = secondaryCircle.style.height = `${diameter * 0.8}px`;
                secondaryCircle.style.left = `${event.clientX - (btn.offsetLeft + radius * 0.8)}px`;
                secondaryCircle.style.top = `${event.clientY - (btn.offsetTop + radius * 0.8)}px`;
                secondaryCircle.classList.add("ripple");
                secondaryCircle.style.animationDelay = "0.1s";
                secondaryCircle.style.opacity = "0.6";
                
                btn.appendChild(secondaryCircle);
            }, 50);

            // Clean up ripples after animation
            setTimeout(() => {
                if (circle.parentNode) {
                    circle.remove();
                }
                const secondaryRipples = btn.getElementsByClassName("ripple");
                Array.from(secondaryRipples).forEach(ripple => {
                    if (ripple !== circle) ripple.remove();
                });
            }, 800);
        }

        // Add ripple effect to all buttons with ripple-btn class
        document.addEventListener('DOMContentLoaded', function() {
            const rippleButtons = document.querySelectorAll('.ripple-btn');
            rippleButtons.forEach(button => {
                button.addEventListener('click', rippleEffect);
            });
        });
        let currentCourse = null;
        let courseContent = null;
        let currentChapterIndex = 0;
        let completedChapters = new Set();
        let isContentLoaded = false;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const courseId = urlParams.get('course');
            
            if (courseId) {
                loadCourse(courseId);
            } else {
                alert('No course specified');
                window.location.href = 'index.html';
            }

            setupEventListeners();
            mermaid.initialize({ startOnLoad: true });
        });

        function setupEventListeners() {
            // Content filters
            document.getElementById('showTheory').addEventListener('change', updateContentDisplay);
            document.getElementById('showCode').addEventListener('change', updateContentDisplay);
            document.getElementById('showTips').addEventListener('change', updateContentDisplay);

            // Navigation buttons
            document.getElementById('prevChapterBtn').addEventListener('click', () => navigateChapter(-1));
            document.getElementById('nextChapterBtn').addEventListener('click', () => navigateChapter(1));
            document.getElementById('prevChapterBtnTop').addEventListener('click', () => navigateChapter(-1));
            document.getElementById('nextChapterBtnTop').addEventListener('click', () => navigateChapter(1));

            // Quiz button
            document.getElementById('quizBtn').addEventListener('click', () => {
                window.location.href = `quiz.html?course=${currentCourse.id}`;
            });
        }

        async function loadCourse(courseId) {
            // Load course data
            currentCourse = getCourseById(courseId);
            if (!currentCourse) {
                alert('Course not found');
                window.location.href = 'index.html';
                return;
            }

            // Update course header
            updateCourseHeader();

            // Load course content with timeout protection
            let contentLoaded = false;
            
            try {
                // Create script element for the course content
                const script = document.createElement('script');
                script.src = `courses/${courseId}/${courseId}_content.js`;
                
                // Set a timeout to prevent infinite loading
                const loadTimeout = setTimeout(() => {
                    if (!contentLoaded) {
                        console.log('Course content loading timeout, using demo content');
                        loadDemoContent(courseId);
                        contentLoaded = true;
                    }
                }, 3000); // 3 second timeout
                
                script.onload = function() {
                    if (!contentLoaded) {
                        clearTimeout(loadTimeout);
                        contentLoaded = true;
                        
                        // Content should now be available in window.courseContent
                        if (window.courseContent) {
                            courseContent = window.courseContent;
                            initializeCourse();
                        } else {
                            console.log('Course content not found in loaded script, using demo content');
                            loadDemoContent(courseId);
                        }
                    }
                };
                
                script.onerror = function() {
                    if (!contentLoaded) {
                        clearTimeout(loadTimeout);
                        contentLoaded = true;
                        console.log('Failed to load course content, using demo content');
                        loadDemoContent(courseId);
                    }
                };
                
                document.head.appendChild(script);
                
            } catch (error) {
                if (!contentLoaded) {
                    contentLoaded = true;
                    console.log('Error loading course content, using demo content');
                    loadDemoContent(courseId);
                }
            }
        }

        function updateCourseHeader() {
            document.getElementById('courseTitle').textContent = currentCourse.name;
            document.getElementById('courseInstructor').textContent = `Instructor: ${currentCourse.instructor}`;
            document.getElementById('courseDuration').textContent = currentCourse.duration;
            document.getElementById('courseDifficulty').textContent = currentCourse.difficulty;
            document.getElementById('courseModules').textContent = currentCourse.modules;
            document.title = `VidyaLMS - ${currentCourse.name}`;
        }

        function loadDemoContent(courseId) {
            // Demo content for AI Foundations
            if (courseId === 'ai-foundations') {
                courseContent = {
                    chapters: [
                        {
                            id: 1,
                            title: 'AI Basics',
                            description: 'Core concepts & applications',
                            theory: `
                                <div class="prose max-w-none">
                                    <h3 class="mobile-text-lg sm:mobile-text-xl font-bold mb-4">What is Artificial Intelligence?</h3>
                                    <p class="mobile-text-sm sm:mobile-text-base mb-4">Artificial Intelligence (AI) is the simulation of human intelligence in machines that are programmed to think and learn like humans. AI systems can perform tasks that typically require human intelligence, such as visual perception, speech recognition, decision-making, and language translation.</p>
                                    
                                    <h4 class="mobile-text-base sm:mobile-text-lg font-semibold mb-3 mt-6">Brief History of AI</h4>
                                    <ul class="list-disc pl-6 mb-4 mobile-text-sm sm:mobile-text-base">
                                        <li><strong>1950s:</strong> Alan Turing proposes the Turing Test</li>
                                        <li><strong>1956:</strong> Term "Artificial Intelligence" coined at Dartmouth Conference</li>
                                        <li><strong>1980s:</strong> Expert systems gain popularity</li>
                                        <li><strong>1990s:</strong> Machine learning algorithms advance</li>
                                        <li><strong>2010s:</strong> Deep learning revolution begins</li>
                                        <li><strong>2020s:</strong> Large language models and generative AI emerge</li>
                                    </ul>

                                    <h4 class="mobile-text-base sm:mobile-text-lg font-semibold mb-3 mt-6">Types of AI</h4>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                                        <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500">
                                            <h5 class="font-bold text-blue-800 mobile-text-sm">Narrow AI (ANI)</h5>
                                            <p class="text-blue-700 mobile-text-xs sm:mobile-text-sm">AI designed for specific tasks. This is what we have today.</p>
                                            <p class="text-xs text-blue-600 mt-2">Examples: Siri, Chess programs, Image recognition</p>
                                        </div>
                                        <div class="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-500">
                                            <h5 class="font-bold text-yellow-800 mobile-text-sm">General AI (AGI)</h5>
                                            <p class="text-yellow-700 mobile-text-xs sm:mobile-text-sm">AI with human-level cognitive abilities across all domains.</p>
                                            <p class="text-xs text-yellow-600 mt-2">Status: Theoretical, not yet achieved</p>
                                        </div>
                                        <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-500">
                                            <h5 class="font-bold text-red-800 mobile-text-sm">Super AI (ASI)</h5>
                                            <p class="text-red-700 mobile-text-xs sm:mobile-text-sm">AI that surpasses human intelligence in all aspects.</p>
                                            <p class="text-xs text-red-600 mt-2">Status: Hypothetical future possibility</p>
                                        </div>
                                    </div>
                                </div>
                            `
                        },
                        {
                            id: 2,
                            title: 'Machine Learning',
                            description: 'Algorithms & training',
                            theory: `
                                <div class="prose max-w-none">
                                    <h3 class="mobile-text-lg sm:mobile-text-xl font-bold mb-4">Machine Learning Fundamentals</h3>
                                    <p class="mobile-text-sm sm:mobile-text-base mb-4">Machine learning is a subset of AI that enables computers to learn and improve from experience without being explicitly programmed.</p>
                                    
                                    <h4 class="mobile-text-base sm:mobile-text-lg font-semibold mb-3 mt-6">Types of Machine Learning</h4>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                                        <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-500">
                                            <h5 class="font-bold text-green-800 mobile-text-sm">Supervised Learning</h5>
                                            <p class="text-green-700 mobile-text-xs sm:mobile-text-sm">Learning from labeled training data to make predictions.</p>
                                            <p class="text-xs text-green-600 mt-2">Examples: Classification, Regression</p>
                                        </div>
                                        <div class="bg-purple-50 p-4 rounded-lg border-l-4 border-purple-500">
                                            <h5 class="font-bold text-purple-800 mobile-text-sm">Unsupervised Learning</h5>
                                            <p class="text-purple-700 mobile-text-xs sm:mobile-text-sm">Finding patterns in data without labels.</p>
                                            <p class="text-xs text-purple-600 mt-2">Examples: Clustering, Dimensionality reduction</p>
                                        </div>
                                        <div class="bg-teal-50 p-4 rounded-lg border-l-4 border-teal-500">
                                            <h5 class="font-bold text-teal-800 mobile-text-sm">Reinforcement Learning</h5>
                                            <p class="text-teal-700 mobile-text-xs sm:mobile-text-sm">Learning through trial and error with rewards.</p>
                                            <p class="text-xs text-teal-600 mt-2">Examples: Game playing, Robotics</p>
                                        </div>
                                    </div>
                                </div>
                            `
                        },
                        {
                            id: 3,
                            title: 'Neural Networks',
                            description: 'Deep learning & architecture',
                            theory: `
                                <div class="prose max-w-none">
                                    <h3 class="mobile-text-lg sm:mobile-text-xl font-bold mb-4">Neural Networks and Deep Learning</h3>
                                    <p class="mobile-text-sm sm:mobile-text-base mb-4">Neural networks are computing systems inspired by biological neural networks in human brains.</p>
                                    
                                    <h4 class="mobile-text-base sm:mobile-text-lg font-semibold mb-3 mt-6">Key Components</h4>
                                    <ul class="list-disc pl-6 mb-4 mobile-text-sm sm:mobile-text-base">
                                        <li><strong>Neurons:</strong> Basic processing units</li>
                                        <li><strong>Layers:</strong> Input, hidden, and output layers</li>
                                        <li><strong>Weights:</strong> Connection strengths between neurons</li>
                                        <li><strong>Activation Functions:</strong> Determine neuron output</li>
                                        <li><strong>Backpropagation:</strong> Learning algorithm</li>
                                    </ul>

                                    <h4 class="mobile-text-base sm:mobile-text-lg font-semibold mb-3 mt-6">Applications</h4>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                                        <div class="bg-indigo-50 p-4 rounded-lg border-l-4 border-indigo-500">
                                            <h5 class="font-bold text-indigo-800 mobile-text-sm">Computer Vision</h5>
                                            <p class="text-indigo-700 mobile-text-xs sm:mobile-text-sm">Image recognition, object detection, facial recognition</p>
                                        </div>
                                        <div class="bg-pink-50 p-4 rounded-lg border-l-4 border-pink-500">
                                            <h5 class="font-bold text-pink-800 mobile-text-sm">Natural Language Processing</h5>
                                            <p class="text-pink-700 mobile-text-xs sm:mobile-text-sm">Text analysis, translation, chatbots</p>
                                        </div>
                                    </div>
                                </div>
                            `
                        }
                    ]
                };
            }
            
            initializeCourse();
        }

        function initializeCourse() {
            if (!isContentLoaded && courseContent && courseContent.chapters.length > 0) {
                isContentLoaded = true;
                renderChapters();
                displayChapter(0); // Display first chapter
            }
        }

        function renderChapters() {
            const chaptersList = document.getElementById('chaptersList');
            chaptersList.innerHTML = '';

            document.getElementById('chapterCount').textContent = `${courseContent.chapters.length}`;

            courseContent.chapters.forEach((chapter, index) => {
                const chapterItem = document.createElement('div');
                chapterItem.className = `chapter-item ${index === currentChapterIndex ? 'active' : 'text-slate-200'}`;
                
                const isCompleted = completedChapters.has(index);
                chapterItem.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex-1 min-w-0">
                            <div class="font-medium mobile-text-sm break-words">${chapter.id}. ${chapter.title}</div>
                            <div class="mobile-text-xs opacity-75 mt-1 break-words text-slate-300">${chapter.description}</div>
                        </div>
                        <div class="text-right ml-2">
                            ${isCompleted ? '<span class="text-green-400">✓</span>' : '<span class="text-slate-500">○</span>'}
                        </div>
                    </div>
                `;
                
                chapterItem.onclick = () => displayChapter(index);
                chaptersList.appendChild(chapterItem);
            });
        }

        function displayChapter(chapterIndex) {
            if (chapterIndex < 0 || chapterIndex >= courseContent.chapters.length) return;
            
            currentChapterIndex = chapterIndex;
            const chapter = courseContent.chapters[chapterIndex];
            
            // Update chapter header
            document.getElementById('chapterTitle').textContent = chapter.title;
            document.getElementById('chapterDescription').textContent = chapter.description;
            
            // Mark chapter as completed when viewed
            completedChapters.add(chapterIndex);
            
            // Update content
            updateContentDisplay();
            
            // Update navigation buttons
            updateNavigationButtons();
            
            // Update progress
            updateProgress();
            
            // Update chapter styling without re-rendering
            updateChapterStyling();
        }

        function updateChapterStyling() {
            const chapterItems = document.querySelectorAll('.chapter-item');
            chapterItems.forEach((item, index) => {
                if (index === currentChapterIndex) {
                    item.className = 'chapter-item active';
                } else {
                    item.className = 'chapter-item text-slate-200';
                }
                
                // Update completion status
                const isCompleted = completedChapters.has(index);
                const statusSpan = item.querySelector('.text-right span');
                if (statusSpan) {
                    statusSpan.className = isCompleted ? 'text-green-400' : 'text-slate-500';
                    statusSpan.textContent = isCompleted ? '✓' : '○';
                }
            });
        }

        function updateContentDisplay() {
            if (!courseContent || !courseContent.chapters[currentChapterIndex]) return;
            
            const chapter = courseContent.chapters[currentChapterIndex];
            const showTheory = document.getElementById('showTheory').checked;
            const showCode = document.getElementById('showCode').checked;
            const showTips = document.getElementById('showTips').checked;

            let html = '';
            
            if (showTheory && chapter.theory) {
                html += `<div class="content-section theory-content mb-8">${chapter.theory}</div>`;
            }
            
            if (showCode && chapter.code) {
                html += `<div class="content-section code-content mb-8">${chapter.code}</div>`;
            }
            
            if (showTips && chapter.tips) {
                html += `<div class="content-section tips-content">${chapter.tips}</div>`;
            }

            document.getElementById('chapterContent').innerHTML = html || '<div class="text-center py-12 text-gray-500 mobile-text-sm sm:mobile-text-base">Select content types to view</div>';
            
            // Fix: Use setTimeout to avoid call stack issues and only highlight if Prism exists
            if (typeof Prism !== 'undefined' && Prism.highlightElement) {
                setTimeout(() => {
                    try {
                        // Only highlight code blocks in the chapter content area
                        const contentArea = document.getElementById('chapterContent');
                        const codeBlocks = contentArea.querySelectorAll('pre code');
                        codeBlocks.forEach(block => {
                            Prism.highlightElement(block);
                        });
                    } catch (error) {
                        console.warn('Prism highlighting error:', error);
                    }
                }, 100);
            }
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevChapterBtn');
            const nextBtn = document.getElementById('nextChapterBtn');
            const prevBtnTop = document.getElementById('prevChapterBtnTop');
            const nextBtnTop = document.getElementById('nextChapterBtnTop');
            
            prevBtn.disabled = currentChapterIndex === 0;
            nextBtn.disabled = currentChapterIndex === courseContent.chapters.length - 1;
            prevBtnTop.disabled = currentChapterIndex === 0;
            nextBtnTop.disabled = currentChapterIndex === courseContent.chapters.length - 1;
        }

        function navigateChapter(direction) {
            const newIndex = currentChapterIndex + direction;
            if (newIndex >= 0 && newIndex < courseContent.chapters.length) {
                displayChapter(newIndex);
            }
        }

        function updateProgress() {
            const progress = (completedChapters.size / courseContent.chapters.length) * 100;
            const progressCircle = document.getElementById('progressCircle');
            const progressPercent = document.getElementById('progressPercent');
            
            // Update progress circle
            const circumference = 2 * Math.PI * 28; // r = 28
            const dashArray = (progress / 100) * circumference;
            progressCircle.style.strokeDasharray = `${dashArray} ${circumference}`;
            
            // Update percentage text
            progressPercent.textContent = `${Math.round(progress)}%`;
        }

        function copyCode(button) {
            const codeBlock = button.closest('.bg-gray-900').querySelector('code');
            const textArea = document.createElement('textarea');
            textArea.value = codeBlock.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            // Visual feedback
            const originalText = button.textContent;
            button.textContent = '✅ Copied!';
            button.classList.add('bg-green-600');
            setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('bg-green-600');
            }, 2000);
        }
    </script>
</body>
</html>